"use strict";(()=>{var e={};e.id=825,e.ids=[825],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9261:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f});var a={};t.r(a),t.d(a,{GET:()=>d,POST:()=>c});var s=t(9303),i=t(8716),o=t(670),n=t(7070),u=t(9487),l=t(2872),p=t(4068);async function c(e){try{let{talkPageId:r,email:t,name:a,tier:s}=await e.json();if(!r||!t||!s)return n.NextResponse.json({error:"Missing required fields"},{status:400});if(await u._.emailCapture.findUnique({where:{email_talkPageId:{email:t,talkPageId:r}}}))return n.NextResponse.json({success:!0,message:"Email already captured",isNew:!1});await u._.emailCapture.create({data:{email:t,name:a,tier:s,talkPageId:r}}),await u._.analytics.create({data:{event:"email_capture",talkPageId:r,data:{email:t,tier:s,timestamp:new Date().toISOString()}}});let i=await u._.talkPage.findUnique({where:{id:r},include:{customGpts:{orderBy:{order:"asc"}},downloads:{orderBy:{order:"asc"}},businessLinks:{orderBy:{order:"asc"}}}});if(i){let e=[...i.customGpts.map(e=>({name:e.name,description:e.description,url:e.url,type:"gpt"})),...i.downloads.map(e=>({name:e.title,description:e.description||"",url:e.fileUrl,type:"download"})),...i.businessLinks.map(e=>({name:e.name,description:e.description,url:e.url,type:"resource"}))];try{await (0,l.P)({to:t,recipientName:a||void 0,speakerName:i.speakerName,speakerEmail:i.speakerEmail||void 0,talkTitle:i.title,tools:e,pageUrl:(0,p.W)(`/talk/${i.slug}`)}),console.log("Welcome email sent successfully to:",t)}catch(e){console.error("Failed to send welcome email:",e)}}return n.NextResponse.json({success:!0,message:"Email captured successfully",isNew:!0})}catch(e){return console.error("Error capturing email:",e),n.NextResponse.json({error:"Failed to capture email"},{status:500})}}async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("talkPageId"),a=e.cookies.get("userId")?.value;if(!a)return n.NextResponse.json({error:"Unauthorized"},{status:401});if(!t)return n.NextResponse.json({error:"Talk page ID required"},{status:400});if(!await u._.talkPage.findFirst({where:{id:t,userId:a}}))return n.NextResponse.json({error:"Talk page not found"},{status:404});let s=await u._.emailCapture.findMany({where:{talkPageId:t},orderBy:{createdAt:"desc"}});return n.NextResponse.json(s)}catch(e){return console.error("Error fetching email captures:",e),n.NextResponse.json({error:"Failed to fetch email captures"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/email-capture/route",pathname:"/api/email-capture",filename:"route",bundlePath:"app/api/email-capture/route"},resolvedPagePath:"/Users/noahcheyer/MicDrop/app/api/email-capture/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:w}=m,h="/api/email-capture/route";function y(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},9487:(e,r,t)=>{t.d(r,{_:()=>s});var a=t(3524);t(2237);let s=global.prisma||new a.PrismaClient({log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[948,972,237,969],()=>t(9261));module.exports=a})();